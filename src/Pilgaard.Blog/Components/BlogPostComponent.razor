@page "/posts/{blogPostSeriesPathName}/{blogPostPathName}"
<article class="blog-post">
    @if (BlogPostSeries is not null && BlogPost is not null)
    {
        <h3>@BlogPostSeries.DisplayName - Part @BlogPost?.NumberInSeries</h3>
        <h1>@BlogPost?.DisplayName</h1>
        <hr />
        <br />
    }
    @BlogPostText
</article>
<PrismCodeBlockRenderer/>
<GiscusComponent/>
@code {
    public BlogPost? BlogPost { get; set; }
    public BlogPostSeries? BlogPostSeries { get; set; }

    [Parameter]
    public string? BlogPostSeriesPathName { get; set; }

    [Parameter]
    public string BlogPostPathName { get; set; } = null!;

    private MarkupString BlogPostText { get; set; }

    protected override async Task OnInitializedAsync()
    {
        BlogPostSeriesPathName ??= "general";
        BlogPostSeries = BlogPosts.AllBlogPostSeries.FirstOrDefault(series => series.PathName == BlogPostSeriesPathName);
        BlogPost = BlogPostSeries?.BlogPosts.FirstOrDefault(blogPost => blogPost.PathName == BlogPostPathName);
        var pathPrefix = Path.Join(AppDomain.CurrentDomain.BaseDirectory, "Pages", "posts");
        var path = BlogPostSeriesPathName is null ? 
            Path.Join(pathPrefix, BlogPostPathName + ".md") :
            Path.Join(pathPrefix, BlogPostSeriesPathName, BlogPostPathName + ".md");

        var text = await File.ReadAllTextAsync(path);
        BlogPostText = text.ToHtml();
        await base.OnInitializedAsync();
    }
}
